#!/bin/bash
source ~/.clanker/.env

prompt="$*"
[ ! -t 0 ] && input="$(cat)"

msgs='[]'
[ -n "$prompt" ] && msgs=$(echo "$msgs" | jq --arg p "$prompt" '. + [{role:"user",content:$p}]')
[ -n "$input" ] && msgs=$(echo "$msgs" | jq --arg i "$input" '. + [{role:"user",content:$i}]')
[ "$msgs" = "[]" ] && msgs='[{"role":"user","content":""}]'

curl -sS https://api.openai.com/v1/responses \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "Content-Type: application/json" \
  -d "$(jq -n --argjson m "$msgs" '{model:"gpt-4.1-mini",input:$m}')" \
  | jq -r '.output[0].content[0].text'
